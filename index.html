<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>뉴스 TTS 스크롤</title>
  <style>
    body { margin:0; background: transparent; overflow:hidden; }
    #wrapper { position: fixed; top:0; left:0; transform:translateY(-8px); z-index:9999; }
    #news {
      position: fixed;
      top:0; left:0;
      white-space: nowrap;
      display:inline-block;
      font-size:28px; color:white; font-weight:bold;
      text-shadow: -1px0 black,0 1px black,1px0 black,0 -1px black,-1px-1px black,-1px1px black,1px-1px black,1px1px black;
      will-change: transform;
      backface-visibility: hidden;
      animation: scroll 120s linear infinite;
      z-index:9999;
    }
    @keyframes scroll { 0%{transform:translateX(100vw);} 100%{transform:translateX(-100%);} }
  </style>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
  1111<div id="wrapper">
    <div id="news">뉴스 로딩 중...</div>
  </div>

  <script>
    // --- Firebase 초기화 ---
    const firebaseConfig = {
      apiKey: "AIzaSyAQGtOEcxFxl9FV7NASLgxLDc23u2vzS_0",
      authDomain: "mygps-11798.firebaseapp.com",
      databaseURL: "https://mygps-11798-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "mygps-11798",
      storageBucket: "mygps-11798.firebasestorage.app",
      messagingSenderId: "271371741627",
      appId: "1:271371741627:web:642901f43c5ad57d80bc9e"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const ttsRef = db.ref("ttsButton");

    // --- 뉴스 로딩 ---
    let lastNews = "";
    async function loadNews() {
      try {
        let res = await fetch("https://api.rss2json.com/v1/api.json?rss_url=https://news.google.com/rss?hl=ko&gl=KR&ceid=KR:ko");
        let data = await res.json();
        let newsText = data.items.map(i => i.title).join("   |   ");
        if (newsText !== lastNews) {
          document.getElementById("news").innerText = newsText;
          lastNews = newsText;
        }
      } catch(e) { console.error("뉴스 불러오기 실패", e); }
    }
    loadNews();
    setInterval(loadNews, 300000);

    // --- TTS 재생/정지 ---
    let isSpeaking = false;
    let utter = null;
    let lastTimestamp = 0; // 마지막으로 처리한 timestamp

    ttsRef.on("value", snapshot => {
      const timestamp = snapshot.val();
      if (timestamp && timestamp > lastTimestamp) {
        // 새로운 신호이면 처리
        if (!isSpeaking) {
          utter = new SpeechSynthesisUtterance(lastNews);
          utter.lang = "ko-KR";
          utter.rate = 1;
          utter.pitch = 1;
          speechSynthesis.speak(utter);
          isSpeaking = true;
        } else {
          speechSynthesis.cancel();
          isSpeaking = false;
        }
        lastTimestamp = timestamp;
      }
    });
  </script>
</body>
</html>
